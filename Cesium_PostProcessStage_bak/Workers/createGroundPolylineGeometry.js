/**
 * Cesium - https://github.com/AnalyticalGraphicsInc/cesium
 *
 * Copyright 2011-2017 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md for full licensing details.
 */
define(["./defined-b9ff0e39","./Check-e6691f86","./freezeObject-2d5b18ce","./defaultValue-199f5aa8","./Math-2145e044","./Cartesian2-40ed5530","./defineProperties-ae15c9d5","./Transforms-94513c2d","./RuntimeError-d5522ee3","./WebGLConstants-554ddbe2","./ComponentDatatype-9477db2c","./GeometryAttribute-4754007e","./when-c208a7cf","./EncodedCartesian3-e7615897","./IntersectionTests-f6d27a39","./Plane-297770b0","./WebMercatorProjection-a290a2f5","./arrayRemoveDuplicates-32bbc2e4","./ArcType-c72d871a","./EllipsoidRhumbLine-d5ed1c3f","./EllipsoidGeodesic-b257688e"],function(G,p,e,h,ze,Be,a,Ge,t,r,Ve,je,i,Ye,V,n,s,j,Y,q,M){"use strict";function o(e){e=h.defaultValue(e,h.defaultValue.EMPTY_OBJECT),this._ellipsoid=h.defaultValue(e.ellipsoid,Be.Ellipsoid.WGS84),this._rectangle=h.defaultValue(e.rectangle,Be.Rectangle.MAX_VALUE),this._projection=new Ge.GeographicProjection(this._ellipsoid),this._numberOfLevelZeroTilesX=h.defaultValue(e.numberOfLevelZeroTilesX,2),this._numberOfLevelZeroTilesY=h.defaultValue(e.numberOfLevelZeroTilesY,1)}a.defineProperties(o.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),o.prototype.getNumberOfXTilesAtLevel=function(e){return this._numberOfLevelZeroTilesX<<e},o.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY<<e},o.prototype.rectangleToNativeRectangle=function(e,a){p.Check.defined("rectangle",e);var t=ze.CesiumMath.toDegrees(e.west),r=ze.CesiumMath.toDegrees(e.south),i=ze.CesiumMath.toDegrees(e.east),n=ze.CesiumMath.toDegrees(e.north);return G.defined(a)?(a.west=t,a.south=r,a.east=i,a.north=n,a):new Be.Rectangle(t,r,i,n)},o.prototype.tileXYToNativeRectangle=function(e,a,t,r){var i=this.tileXYToRectangle(e,a,t,r);return i.west=ze.CesiumMath.toDegrees(i.west),i.south=ze.CesiumMath.toDegrees(i.south),i.east=ze.CesiumMath.toDegrees(i.east),i.north=ze.CesiumMath.toDegrees(i.north),i},o.prototype.tileXYToRectangle=function(e,a,t,r){var i=this._rectangle,n=this.getNumberOfXTilesAtLevel(t),s=this.getNumberOfYTilesAtLevel(t),o=i.width/n,l=e*o+i.west,u=(e+1)*o+i.west,c=i.height/s,C=i.north-a*c,d=i.north-(a+1)*c;return G.defined(r)||(r=new Be.Rectangle(l,d,u,C)),r.west=l,r.south=d,r.east=u,r.north=C,r},o.prototype.positionToTileXY=function(e,a,t){var r=this._rectangle;if(Be.Rectangle.contains(r,e)){var i=this.getNumberOfXTilesAtLevel(a),n=this.getNumberOfYTilesAtLevel(a),s=r.width/i,o=r.height/n,l=e.longitude;r.east<r.west&&(l+=ze.CesiumMath.TWO_PI);var u=(l-r.west)/s|0;i<=u&&(u=i-1);var c=(r.north-e.latitude)/o|0;return n<=c&&(c=n-1),G.defined(t)?(t.x=u,t.y=c,t):new Be.Cartesian2(u,c)}};var u=new Be.Cartesian3,c=new Be.Cartesian3,C=new Be.Cartographic,d=new Be.Cartesian3,g=new Be.Cartesian3,l=new Ge.BoundingSphere,f=new o,m=[new Be.Cartographic,new Be.Cartographic,new Be.Cartographic,new Be.Cartographic],w=new Be.Cartesian2,qe={};function v(e){Be.Cartographic.fromRadians(e.east,e.north,0,m[0]),Be.Cartographic.fromRadians(e.west,e.north,0,m[1]),Be.Cartographic.fromRadians(e.east,e.south,0,m[2]),Be.Cartographic.fromRadians(e.west,e.south,0,m[3]);var a,t=0,r=0,i=0,n=0,s=qe._terrainHeightsMaxLevel;for(a=0;a<=s;++a){for(var o=!1,l=0;l<4;++l){var u=m[l];if(f.positionToTileXY(u,a,w),0===l)i=w.x,n=w.y;else if(i!==w.x||n!==w.y){o=!0;break}}if(o)break;t=i,r=n}if(0!==a)return{x:t,y:r,level:s<a?s:a-1}}qe.initialize=function(){var e=qe._initPromise;return G.defined(e)?e:(e=Ge.Resource.fetchJson(Ge.buildModuleUrl("Assets/approximateTerrainHeights.json")).then(function(e){qe._terrainHeights=e}),qe._initPromise=e)},qe.getMinimumMaximumHeights=function(e,a){if(p.Check.defined("rectangle",e),!G.defined(qe._terrainHeights))throw new p.DeveloperError("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");a=h.defaultValue(a,Be.Ellipsoid.WGS84);var t=v(e),r=qe._defaultMinTerrainHeight,i=qe._defaultMaxTerrainHeight;if(G.defined(t)){var n=t.level+"-"+t.x+"-"+t.y,s=qe._terrainHeights[n];G.defined(s)&&(r=s[0],i=s[1]),a.cartographicToCartesian(Be.Rectangle.northeast(e,C),u),a.cartographicToCartesian(Be.Rectangle.southwest(e,C),c),Be.Cartesian3.midpoint(c,u,d);var o=a.scaleToGeodeticSurface(d,g);if(G.defined(o)){var l=Be.Cartesian3.distance(d,o);r=Math.min(r,-l)}else r=qe._defaultMinTerrainHeight}return{minimumTerrainHeight:r=Math.max(qe._defaultMinTerrainHeight,r),maximumTerrainHeight:i}},qe.getBoundingSphere=function(e,a){if(p.Check.defined("rectangle",e),!G.defined(qe._terrainHeights))throw new p.DeveloperError("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");a=h.defaultValue(a,Be.Ellipsoid.WGS84);var t=v(e),r=qe._defaultMaxTerrainHeight;if(G.defined(t)){var i=t.level+"-"+t.x+"-"+t.y,n=qe._terrainHeights[i];G.defined(n)&&(r=n[1])}var s=Ge.BoundingSphere.fromRectangle3D(e,a,0);return Ge.BoundingSphere.fromRectangle3D(e,a,r,l),Ge.BoundingSphere.union(s,l,s)},qe._terrainHeightsMaxLevel=6,qe._defaultMaxTerrainHeight=9e3,qe._defaultMinTerrainHeight=-1e5,qe._terrainHeights=void 0,qe._initPromise=void 0,a.defineProperties(qe,{initialized:{get:function(){return G.defined(qe._terrainHeights)}}});var F=[Ge.GeographicProjection,s.WebMercatorProjection],y=F.length,Fe=Math.cos(ze.CesiumMath.toRadians(30)),T=Math.cos(ze.CesiumMath.toRadians(150)),X=0,U=1e3;function E(e){var a=(e=h.defaultValue(e,h.defaultValue.EMPTY_OBJECT)).positions;if(!G.defined(a)||a.length<2)throw new p.DeveloperError("At least two positions are required.");if(G.defined(e.arcType)&&e.arcType!==Y.ArcType.GEODESIC&&e.arcType!==Y.ArcType.RHUMB)throw new p.DeveloperError("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=h.defaultValue(e.width,1),this._positions=a,this.granularity=h.defaultValue(e.granularity,9999),this.loop=h.defaultValue(e.loop,!1),this.arcType=h.defaultValue(e.arcType,Y.ArcType.GEODESIC),this._ellipsoid=Be.Ellipsoid.WGS84,this._projectionIndex=0,this._workerName="createGroundPolylineGeometry",this._scene3DOnly=!1}a.defineProperties(E.prototype,{packedLength:{get:function(){return 1+3*this._positions.length+1+1+1+Be.Ellipsoid.packedLength+1+1}}}),E.setProjectionAndEllipsoid=function(e,a){for(var t=0,r=0;r<y;r++)if(a instanceof F[r]){t=r;break}e._projectionIndex=t,e._ellipsoid=a.ellipsoid};var _=new Be.Cartesian3,O=new Be.Cartesian3,A=new Be.Cartesian3;function W(e,a,t,r,i){var n=J(r,e,0,_),s=J(r,e,t,O),o=J(r,a,0,A),l=Xe(s,n,O),u=Xe(o,n,A);return Be.Cartesian3.cross(u,l,i),Be.Cartesian3.normalize(i,i)}var b=new Be.Cartographic,k=new Be.Cartesian3,P=new Be.Cartesian3,S=new Be.Cartesian3;function Z(e,a,t,r,i,n,s,o,l,u,c){if(0!==i){var C;n===Y.ArcType.GEODESIC?C=new M.EllipsoidGeodesic(e,a,s):n===Y.ArcType.RHUMB&&(C=new q.EllipsoidRhumbLine(e,a,s));var d=C.surfaceDistance;if(!(d<i))for(var p=W(e,a,r,s,S),h=Math.ceil(d/i),g=d/h,f=g,m=h-1,w=o.length,v=0;v<m;v++){var y=C.interpolateUsingSurfaceDistance(f,b),T=J(s,y,t,k),E=J(s,y,r,P);Be.Cartesian3.pack(p,o,w),Be.Cartesian3.pack(T,l,w),Be.Cartesian3.pack(E,u,w),c.push(y.latitude),c.push(y.longitude),w+=3,f+=g}}}var L=new Be.Cartographic;function J(e,a,t,r){return Be.Cartographic.clone(a,L),L.height=t,Be.Cartographic.toCartesian(L,e,r)}function Xe(e,a,t){return Be.Cartesian3.subtract(e,a,t),Be.Cartesian3.normalize(t,t),t}function I(e,a,t,r){return r=Xe(e,a,r),r=Be.Cartesian3.cross(r,t,r),r=Be.Cartesian3.normalize(r,r),r=Be.Cartesian3.cross(t,r,r)}E.pack=function(e,a,t){p.Check.typeOf.object("value",e),p.Check.defined("array",a);var r=h.defaultValue(t,0),i=e._positions,n=i.length;a[r++]=n;for(var s=0;s<n;++s){var o=i[s];Be.Cartesian3.pack(o,a,r),r+=3}return a[r++]=e.granularity,a[r++]=e.loop?1:0,a[r++]=e.arcType,Be.Ellipsoid.pack(e._ellipsoid,a,r),r+=Be.Ellipsoid.packedLength,a[r++]=e._projectionIndex,a[r++]=e._scene3DOnly?1:0,a},E.unpack=function(e,a,t){p.Check.defined("array",e);for(var r=h.defaultValue(a,0),i=e[r++],n=new Array(i),s=0;s<i;s++)n[s]=Be.Cartesian3.unpack(e,r),r+=3;var o=e[r++],l=1===e[r++],u=e[r++],c=Be.Ellipsoid.unpack(e,r);r+=Be.Ellipsoid.packedLength;var C=e[r++],d=1===e[r++];return G.defined(t)||(t=new E({positions:n})),t._positions=n,t.granularity=o,t.loop=l,t.arcType=u,t._ellipsoid=c,t._projectionIndex=C,t._scene3DOnly=d,t};var x=new Be.Cartesian3,D=new Be.Cartesian3,N=new Be.Cartesian3,R=new Be.Cartesian3;function Q(e,a,t,r,i){var n=Xe(t,a,R),s=I(e,a,n,x),o=I(r,a,n,D);if(ze.CesiumMath.equalsEpsilon(Be.Cartesian3.dot(s,o),-1,ze.CesiumMath.EPSILON5))return i=Be.Cartesian3.cross(n,s,i),i=Be.Cartesian3.normalize(i,i);i=Be.Cartesian3.add(o,s,i),i=Be.Cartesian3.normalize(i,i);var l=Be.Cartesian3.cross(n,i,N);return Be.Cartesian3.dot(o,l)<0&&(i=Be.Cartesian3.negate(i,i)),i}var K=n.Plane.fromPointNormal(Be.Cartesian3.ZERO,Be.Cartesian3.UNIT_Y),$=new Be.Cartesian3,ee=new Be.Cartesian3,ae=new Be.Cartesian3,te=new Be.Cartesian3,re=new Be.Cartesian3,ie=new Be.Cartesian3,ne=new Be.Cartographic,se=new Be.Cartographic,oe=new Be.Cartographic;E.createGeometry=function(e){var a,t,r,i,n,s,o=!e._scene3DOnly,l=e.loop,u=e._ellipsoid,c=e.granularity,C=e.arcType,d=new F[e._projectionIndex](u),p=X,h=U,g=e._positions,f=g.length;2===f&&(l=!1);var m,w,v,y=new q.EllipsoidRhumbLine(void 0,void 0,u),T=[g[0]];for(t=0;t<f-1;t++)r=g[t],i=g[t+1],m=V.IntersectionTests.lineSegmentPlane(r,i,K,ie),!G.defined(m)||Be.Cartesian3.equalsEpsilon(m,r,ze.CesiumMath.EPSILON7)||Be.Cartesian3.equalsEpsilon(m,i,ze.CesiumMath.EPSILON7)||(e.arcType===Y.ArcType.GEODESIC?T.push(Be.Cartesian3.clone(m)):e.arcType===Y.ArcType.RHUMB&&(v=u.cartesianToCartographic(m,ne).longitude,n=u.cartesianToCartographic(r,ne),s=u.cartesianToCartographic(i,se),y.setEndPoints(n,s),w=y.findIntersectionWithLongitude(v,oe),m=u.cartographicToCartesian(w,ie),!G.defined(m)||Be.Cartesian3.equalsEpsilon(m,r,ze.CesiumMath.EPSILON7)||Be.Cartesian3.equalsEpsilon(m,i,ze.CesiumMath.EPSILON7)||T.push(Be.Cartesian3.clone(m)))),T.push(i);l&&(r=g[f-1],i=g[0],m=V.IntersectionTests.lineSegmentPlane(r,i,K,ie),!G.defined(m)||Be.Cartesian3.equalsEpsilon(m,r,ze.CesiumMath.EPSILON7)||Be.Cartesian3.equalsEpsilon(m,i,ze.CesiumMath.EPSILON7)||(e.arcType===Y.ArcType.GEODESIC?T.push(Be.Cartesian3.clone(m)):e.arcType===Y.ArcType.RHUMB&&(v=u.cartesianToCartographic(m,ne).longitude,n=u.cartesianToCartographic(r,ne),s=u.cartesianToCartographic(i,se),y.setEndPoints(n,s),w=y.findIntersectionWithLongitude(v,oe),m=u.cartographicToCartesian(w,ie),!G.defined(m)||Be.Cartesian3.equalsEpsilon(m,r,ze.CesiumMath.EPSILON7)||Be.Cartesian3.equalsEpsilon(m,i,ze.CesiumMath.EPSILON7)||T.push(Be.Cartesian3.clone(m)))));var E=T.length,M=new Array(E);for(t=0;t<E;t++){var _=Be.Cartographic.fromCartesian(T[t],u);_.height=0,M[t]=_}if(!((E=(M=j.arrayRemoveDuplicates(M,Be.Cartographic.equalsEpsilon)).length)<2)){var O=[],A=[],b=[],k=[],P=$,S=ee,L=ae,I=te,x=re,D=M[0],N=M[1];for(P=J(u,M[E-1],p,P),I=J(u,N,p,I),S=J(u,D,p,S),L=J(u,D,h,L),x=l?Q(P,S,L,I,x):W(D,N,h,u,x),Be.Cartesian3.pack(x,A,0),Be.Cartesian3.pack(S,b,0),Be.Cartesian3.pack(L,k,0),O.push(D.latitude),O.push(D.longitude),Z(D,N,p,h,c,C,u,A,b,k,O),t=1;t<E-1;++t){P=Be.Cartesian3.clone(S,P),S=Be.Cartesian3.clone(I,S);var R=M[t];J(u,R,h,L),J(u,M[t+1],p,I),Q(P,S,L,I,x),a=A.length,Be.Cartesian3.pack(x,A,a),Be.Cartesian3.pack(S,b,a),Be.Cartesian3.pack(L,k,a),O.push(R.latitude),O.push(R.longitude),Z(M[t],M[t+1],p,h,c,C,u,A,b,k,O)}var H=M[E-1],z=M[E-2];if(S=J(u,H,p,S),L=J(u,H,h,L),l){var B=M[0];x=Q(P=J(u,z,p,P),S,L,I=J(u,B,p,I),x)}else x=W(z,H,h,u,x);if(a=A.length,Be.Cartesian3.pack(x,A,a),Be.Cartesian3.pack(S,b,a),Be.Cartesian3.pack(L,k,a),O.push(H.latitude),O.push(H.longitude),l){for(Z(H,D,p,h,c,C,u,A,b,k,O),a=A.length,t=0;t<3;++t)A[a+t]=A[t],b[a+t]=b[t],k[a+t]=k[t];O.push(D.latitude),O.push(D.longitude)}return function(e,a,t,r,i,n,s){var o,l,u,c,C,d,p=a._ellipsoid,h=t.length/3-1,g=8*h,f=4*g,m=36*h,w=65535<g?new Uint32Array(m):new Uint16Array(m),v=new Float64Array(3*g),y=new Float32Array(f),T=new Float32Array(f),E=new Float32Array(f),M=new Float32Array(f),_=new Float32Array(f);s&&(u=new Float32Array(f),c=new Float32Array(f),C=new Float32Array(f),d=new Float32Array(2*g));var O=n.length/2,A=0,b=Ke;b.height=0;var k=$e;k.height=0;var P=ea,S=aa;if(s)for(l=0,o=1;o<O;o++)b.latitude=n[l],b.longitude=n[l+1],k.latitude=n[l+2],k.longitude=n[l+3],P=a.project(b,P),S=a.project(k,S),A+=Be.Cartesian3.distance(P,S),l+=2;var L=r.length/3;S=Be.Cartesian3.unpack(r,0,S);var I,x=0;for(l=3,o=1;o<L;o++)P=Be.Cartesian3.clone(S,P),S=Be.Cartesian3.unpack(r,l,S),x+=Be.Cartesian3.distance(P,S),l+=3;l=3;var D=0,N=0,R=0,H=0,z=!1,B=Be.Cartesian3.unpack(t,0,ra),G=Be.Cartesian3.unpack(r,0,aa),V=Be.Cartesian3.unpack(i,0,na);if(e){var j=Be.Cartesian3.unpack(t,t.length-6,ta);Ue(V,j,B,G)&&(V=Be.Cartesian3.negate(V,V))}var Y=0,q=0,F=0;for(o=0;o<h;o++){var X,U,W,Z,J=Be.Cartesian3.clone(B,ta),Q=Be.Cartesian3.clone(G,ea),K=Be.Cartesian3.clone(V,ia);if(z&&(K=Be.Cartesian3.negate(K,K)),B=Be.Cartesian3.unpack(t,l,ra),G=Be.Cartesian3.unpack(r,l,aa),V=Be.Cartesian3.unpack(i,l,na),z=Ue(V,J,B,G),b.latitude=n[D],b.longitude=n[D+1],k.latitude=n[D+2],k.longitude=n[D+3],s){var $=Qe(b,k);X=a.project(b,da);var ee=Xe(U=a.project(k,pa),X,_a);ee.y=Math.abs(ee.y),W=ha,Z=ga,0===$||Be.Cartesian3.dot(ee,Be.Cartesian3.UNIT_Y)>Fe?(W=We(a,b,K,X,ha),Z=We(a,k,V,U,ga)):1===$?(Z=We(a,k,V,U,ga),W.x=0,W.y=ze.CesiumMath.sign(b.longitude-Math.abs(k.longitude)),W.z=0):(W=We(a,b,K,X,ha),Z.x=0,Z.y=ze.CesiumMath.sign(b.longitude-k.longitude),Z.z=0)}var ae=Be.Cartesian3.distance(Q,G),te=Ye.EncodedCartesian3.fromCartesian(J,Ea),re=Be.Cartesian3.subtract(B,J,fa),ie=Be.Cartesian3.normalize(re,va),ne=Be.Cartesian3.subtract(Q,J,ma);ne=Be.Cartesian3.normalize(ne,ne);var se=Be.Cartesian3.cross(ie,ne,va);se=Be.Cartesian3.normalize(se,se);var oe=Be.Cartesian3.cross(ne,K,ya);oe=Be.Cartesian3.normalize(oe,oe);var le=Be.Cartesian3.subtract(G,B,wa);le=Be.Cartesian3.normalize(le,le);var ue=Be.Cartesian3.cross(V,le,Ta);ue=Be.Cartesian3.normalize(ue,ue);var ce,Ce,de,pe=ae/x,he=Y/x,ge=0,fe=0,me=0;if(s){ge=Be.Cartesian3.distance(X,U),ce=Ye.EncodedCartesian3.fromCartesian(X,Ma),Ce=Be.Cartesian3.subtract(U,X,_a);var we=(de=Be.Cartesian3.normalize(Ce,Oa)).x;de.x=de.y,de.y=-we,fe=ge/A,me=q/A}for(I=0;I<8;I++){var ve=H+4*I,ye=N+2*I,Te=ve+3,Ee=I<4?1:-1,Me=2===I||3===I||6===I||7===I?1:-1;Be.Cartesian3.pack(te.high,y,ve),y[Te]=re.x,Be.Cartesian3.pack(te.low,T,ve),T[Te]=re.y,Be.Cartesian3.pack(oe,E,ve),E[Te]=re.z,Be.Cartesian3.pack(ue,M,ve),M[Te]=pe*Ee,Be.Cartesian3.pack(se,_,ve);var _e=he*Me;0===_e&&Me<0&&(_e=9),_[Te]=_e,s&&(u[ve]=ce.high.x,u[ve+1]=ce.high.y,u[ve+2]=ce.low.x,u[ve+3]=ce.low.y,C[ve]=-W.y,C[ve+1]=W.x,C[ve+2]=Z.y,C[ve+3]=-Z.x,c[ve]=Ce.x,c[ve+1]=Ce.y,c[ve+2]=de.x,c[ve+3]=de.y,d[ye]=fe*Ee,0===(_e=me*Me)&&Me<0&&(_e=9),d[ye+1]=_e)}var Oe=ca,Ae=Ca,be=la,ke=ua,Pe=Be.Rectangle.fromCartographicArray(sa,oa),Se=qe.getMinimumMaximumHeights(Pe,p),Le=Se.minimumTerrainHeight,Ie=Se.maximumTerrainHeight;F+=Le,F+=Ie,Ze(J,Q,Le,Ie,Oe,be),Ze(B,G,Le,Ie,Ae,ke);var xe=Be.Cartesian3.multiplyByScalar(se,ze.CesiumMath.EPSILON5,Aa);Be.Cartesian3.add(Oe,xe,Oe),Be.Cartesian3.add(Ae,xe,Ae),Be.Cartesian3.add(be,xe,be),Be.Cartesian3.add(ke,xe,ke),Je(Oe,Ae),Je(be,ke),Be.Cartesian3.pack(Oe,v,R),Be.Cartesian3.pack(Ae,v,R+3),Be.Cartesian3.pack(ke,v,R+6),Be.Cartesian3.pack(be,v,R+9),xe=Be.Cartesian3.multiplyByScalar(se,-2*ze.CesiumMath.EPSILON5,Aa),Be.Cartesian3.add(Oe,xe,Oe),Be.Cartesian3.add(Ae,xe,Ae),Be.Cartesian3.add(be,xe,be),Be.Cartesian3.add(ke,xe,ke),Je(Oe,Ae),Je(be,ke),Be.Cartesian3.pack(Oe,v,R+12),Be.Cartesian3.pack(Ae,v,R+15),Be.Cartesian3.pack(ke,v,R+18),Be.Cartesian3.pack(be,v,R+21),D+=2,l+=3,N+=16,R+=24,H+=32,Y+=ae,q+=ge}var De=l=0;for(o=0;o<h;o++){for(I=0;I<Pa;I++)w[l+I]=ka[I]+De;De+=8,l+=Pa}var Ne=ba;Ge.BoundingSphere.fromVertices(t,Be.Cartesian3.ZERO,3,Ne[0]),Ge.BoundingSphere.fromVertices(r,Be.Cartesian3.ZERO,3,Ne[1]);var Re=Ge.BoundingSphere.fromBoundingSpheres(Ne);Re.radius+=F/(2*h);var He={position:new je.GeometryAttribute({componentDatatype:Ve.ComponentDatatype.DOUBLE,componentsPerAttribute:3,normalize:!1,values:v}),startHiAndForwardOffsetX:Sa(y),startLoAndForwardOffsetY:Sa(T),startNormalAndForwardOffsetZ:Sa(E),endNormalAndTextureCoordinateNormalizationX:Sa(M),rightNormalAndTextureCoordinateNormalizationY:Sa(_)};s&&(He.startHiLo2D=Sa(u),He.offsetAndRight2D=Sa(c),He.startEndNormals2D=Sa(C),He.texcoordNormalization2D=new je.GeometryAttribute({componentDatatype:Ve.ComponentDatatype.FLOAT,componentsPerAttribute:2,normalize:!1,values:d}));return new je.Geometry({attributes:He,indices:w,boundingSphere:Re})}(l,d,b,k,A,O,o)}};var H=new Be.Cartesian3,z=new Ge.Matrix3,B=new Ge.Quaternion;function Ue(e,a,t,r){var i=Xe(t,a,H),n=Be.Cartesian3.dot(i,e);if(Fe<n||n<T){var s=Xe(r,t,R),o=n<T?ze.CesiumMath.PI_OVER_TWO:-ze.CesiumMath.PI_OVER_TWO,l=Ge.Quaternion.fromAxisAngle(s,o,B),u=Ge.Matrix3.fromQuaternion(l,z);return Ge.Matrix3.multiplyByVector(u,e,e),!0}return!1}var le=new Be.Cartographic,ue=new Be.Cartesian3,ce=new Be.Cartesian3;function We(e,a,t,r,i){var n=Be.Cartographic.toCartesian(a,e._ellipsoid,ue),s=Be.Cartesian3.add(n,t,ce),o=!1,l=e._ellipsoid,u=l.cartesianToCartographic(s,le);Math.abs(a.longitude-u.longitude)>ze.CesiumMath.PI_OVER_TWO&&(o=!0,s=Be.Cartesian3.subtract(n,t,ce),u=l.cartesianToCartographic(s,le)),u.height=0;var c=e.project(u,i);return(i=Be.Cartesian3.subtract(c,r,i)).z=0,i=Be.Cartesian3.normalize(i,i),o&&Be.Cartesian3.negate(i,i),i}var Ce=new Be.Cartesian3,de=new Be.Cartesian3;function Ze(e,a,t,r,i,n){var s=Be.Cartesian3.subtract(a,e,Ce);Be.Cartesian3.normalize(s,s);var o=t-X,l=Be.Cartesian3.multiplyByScalar(s,o,de);Be.Cartesian3.add(e,l,i);var u=r-U;l=Be.Cartesian3.multiplyByScalar(s,u,de),Be.Cartesian3.add(a,l,n)}var pe=new Be.Cartesian3;function Je(e,a){var t=n.Plane.getPointDistance(K,e),r=n.Plane.getPointDistance(K,a),i=pe;ze.CesiumMath.equalsEpsilon(t,0,ze.CesiumMath.EPSILON2)?(i=Xe(a,e,i),Be.Cartesian3.multiplyByScalar(i,ze.CesiumMath.EPSILON2,i),Be.Cartesian3.add(e,i,e)):ze.CesiumMath.equalsEpsilon(r,0,ze.CesiumMath.EPSILON2)&&(i=Xe(e,a,i),Be.Cartesian3.multiplyByScalar(i,ze.CesiumMath.EPSILON2,i),Be.Cartesian3.add(a,i,a))}function Qe(e,a){var t=Math.abs(e.longitude),r=Math.abs(a.longitude);if(ze.CesiumMath.equalsEpsilon(t,ze.CesiumMath.PI,ze.CesiumMath.EPSILON11)){var i=ze.CesiumMath.sign(a.longitude);return e.longitude=i*(t-ze.CesiumMath.EPSILON11),1}if(ze.CesiumMath.equalsEpsilon(r,ze.CesiumMath.PI,ze.CesiumMath.EPSILON11)){var n=ze.CesiumMath.sign(e.longitude);return a.longitude=n*(r-ze.CesiumMath.EPSILON11),2}return 0}var Ke=new Be.Cartographic,$e=new Be.Cartographic,ea=new Be.Cartesian3,aa=new Be.Cartesian3,ta=new Be.Cartesian3,ra=new Be.Cartesian3,ia=new Be.Cartesian3,na=new Be.Cartesian3,sa=[Ke,$e],oa=new Be.Rectangle,la=new Be.Cartesian3,ua=new Be.Cartesian3,ca=new Be.Cartesian3,Ca=new Be.Cartesian3,da=new Be.Cartesian3,pa=new Be.Cartesian3,ha=new Be.Cartesian3,ga=new Be.Cartesian3,fa=new Be.Cartesian3,ma=new Be.Cartesian3,wa=new Be.Cartesian3,va=new Be.Cartesian3,ya=new Be.Cartesian3,Ta=new Be.Cartesian3,Ea=new Ye.EncodedCartesian3,Ma=new Ye.EncodedCartesian3,_a=new Be.Cartesian3,Oa=new Be.Cartesian3,Aa=new Be.Cartesian3,ba=[new Ge.BoundingSphere,new Ge.BoundingSphere],ka=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],Pa=ka.length;function Sa(e){return new je.GeometryAttribute({componentDatatype:Ve.ComponentDatatype.FLOAT,componentsPerAttribute:4,normalize:!1,values:e})}return E._projectNormal=We,function(e,a){return qe.initialize().then(function(){return G.defined(a)&&(e=E.unpack(e,a)),E.createGeometry(e)})}});
